---
UID: NC:wincon.PHANDLER_ROUTINE
title: PHANDLER_ROUTINE
author: windows-driver-content
description: An application-defined function used with the SetConsoleCtrlHandler function. A console process uses this function to handle control signals received by the process.
old-location: consoles\handlerroutine.htm
old-project: consoles
ms.assetid: 2e8732fa-7dfd-415b-b2fc-c27a400496f2
ms.author: windowsdriverdev
ms.date: 3/27/2018
ms.keywords: CTRL_BREAK_EVENT, CTRL_CLOSE_EVENT, CTRL_C_EVENT, CTRL_LOGOFF_EVENT, CTRL_SHUTDOWN_EVENT, HandlerRoutine, HandlerRoutine callback function [Consoles], PHANDLER_ROUTINE, _win32_handlerroutine, base.handlerroutine, consoles.handlerroutine, wincon/HandlerRoutine
ms.prod: windows-hardware
ms.technology: windows-devices
ms.topic: callback
req.header: wincon.h
req.include-header: Windows.h
req.target-type: Windows
req.target-min-winverclnt: Windows 2000 Professional [desktop apps only]
req.target-min-winversvr: Windows 2000 Server [desktop apps only]
req.kmdf-ver: 
req.umdf-ver: 
req.ddi-compliance: 
req.unicode-ansi: 
req.idl: 
req.max-support: 
req.namespace: 
req.assembly: 
req.type-library: 
req.typenames: WICMetadataPattern
topic_type:
-	APIRef
-	kbSyntax
api_type:
-	UserDefined
api_location:
-	Wincon.h
api_name:
-	HandlerRoutine
product: Windows
targetos: Windows
req.lib: 
req.dll: 
req.irql: 
req.product: Windows Address Book 5.0
---

# PHANDLER_ROUTINE callback


## -description


An application-defined function used with the 
<a href="https://msdn.microsoft.com/6fc64265-1403-45ea-925c-c5eb31d56734">SetConsoleCtrlHandler</a> function. A console process uses this function to handle control signals received by the process. When the signal is received, the system creates a new thread in the process to execute the function.

The <b>PHANDLER_ROUTINE</b> type defines a pointer to this callback function. 
<b>HandlerRoutine</b> is a placeholder for the application-defined function name.


## -parameters




### -param CtrlType








#### - dwCtrlType [in]

The type of control signal received by the handler. This parameter can be one of the following values.

<table>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
<tr>
<td width="40%"><a id="CTRL_C_EVENT"></a><a id="ctrl_c_event"></a><dl>
<dt><b>CTRL_C_EVENT</b></dt>
<dt>0</dt>
</dl>
</td>
<td width="60%">
A CTRL+C signal was received, either from keyboard input or from a signal generated by the 
<a href="https://msdn.microsoft.com/ed392d97-6fd0-4256-a783-bc7d27d01a10">GenerateConsoleCtrlEvent</a> function.

</td>
</tr>
<tr>
<td width="40%"><a id="CTRL_BREAK_EVENT"></a><a id="ctrl_break_event"></a><dl>
<dt><b>CTRL_BREAK_EVENT</b></dt>
<dt>1</dt>
</dl>
</td>
<td width="60%">
A CTRL+BREAK signal was received, either from keyboard input or from a signal generated by 
<a href="https://msdn.microsoft.com/ed392d97-6fd0-4256-a783-bc7d27d01a10">GenerateConsoleCtrlEvent</a>.

</td>
</tr>
<tr>
<td width="40%"><a id="CTRL_CLOSE_EVENT"></a><a id="ctrl_close_event"></a><dl>
<dt><b>CTRL_CLOSE_EVENT</b></dt>
<dt>2</dt>
</dl>
</td>
<td width="60%">
A signal that the system sends to all processes attached to a console when the user closes the console (either by clicking <b>Close</b> on the console window's window menu, or by clicking the <b>End Task</b> button command from Task Manager).

</td>
</tr>
<tr>
<td width="40%"><a id="CTRL_LOGOFF_EVENT"></a><a id="ctrl_logoff_event"></a><dl>
<dt><b>CTRL_LOGOFF_EVENT</b></dt>
<dt>5</dt>
</dl>
</td>
<td width="60%">
A signal that the system sends to all console processes when a user is logging off. This signal does not indicate which user is logging off, so no assumptions can be made.

Note that this signal is received only by services. Interactive applications are terminated at logoff, so they are not present when the system sends this signal.

</td>
</tr>
<tr>
<td width="40%"><a id="CTRL_SHUTDOWN_EVENT"></a><a id="ctrl_shutdown_event"></a><dl>
<dt><b>CTRL_SHUTDOWN_EVENT</b></dt>
<dt>6</dt>
</dl>
</td>
<td width="60%">
A signal that the system sends when the system is shutting down. Interactive applications are not present by the time the system sends this signal, therefore it can be received only be services in this situation. Services also have their own notification mechanism for shutdown events. For more information, see 
<a href="https://msdn.microsoft.com/e2d6d3a7-070e-4343-abd7-b4b9f8dd6fbc">Handler</a>.

This signal can also be generated by 
an application using <a href="https://msdn.microsoft.com/ed392d97-6fd0-4256-a783-bc7d27d01a10">GenerateConsoleCtrlEvent</a>.

</td>
</tr>
</table>
 


## -returns



If the function handles the control signal, it should return <b>TRUE</b>. If it returns <b>FALSE</b>, the next handler function in the list of handlers for this process is used.




## -remarks



Because the system creates a new thread in the process to execute the handler function, it is possible that the handler function will be terminated by another thread in the process. Be sure to synchronize threads in the process with the thread for the handler function.

Each console process has its own list of 
<b>HandlerRoutine</b> functions. Initially, this list contains only a default handler function that calls 
<a href="https://msdn.microsoft.com/c26dbf15-62e8-4892-b7c5-2e6c085e4cd5">ExitProcess</a>. A console process adds or removes additional handler functions by calling the 
<a href="https://msdn.microsoft.com/6fc64265-1403-45ea-925c-c5eb31d56734">SetConsoleCtrlHandler</a> function, which does not affect the list of handler functions for other processes. When a console process receives any of the control signals, its handler functions are called on a last-registered, first-called basis until one of the handlers returns <b>TRUE</b>. If none of the handlers returns <b>TRUE</b>, the default handler is called.

The <b>CTRL_CLOSE_EVENT</b>, <b>CTRL_LOGOFF_EVENT</b>, and <b>CTRL_SHUTDOWN_EVENT</b> signals give the process an opportunity to clean up before termination. A 
<b>HandlerRoutine</b> can perform any necessary cleanup, then take one of the following actions:

<ul>
<li>Call the 
<a href="https://msdn.microsoft.com/c26dbf15-62e8-4892-b7c5-2e6c085e4cd5">ExitProcess</a> function to terminate the process.</li>
<li>Return <b>FALSE</b>. If none of the registered handler functions returns <b>TRUE</b>, the default handler terminates the process.</li>
<li>Return <b>TRUE</b>. In this case, no other handler functions are called and the system terminates the process.</li>
</ul>
A process can use the 
<a href="https://msdn.microsoft.com/c467950e-31e1-4608-a08a-0736a5524e0e">SetProcessShutdownParameters</a> function to prevent the system from displaying a dialog box to the user during logoff or shutdown. In this case, the system terminates the process when 
<b>HandlerRoutine</b> returns <b>TRUE</b> or when the time-out period elapses.

When a console application is run as a service, it receives a modified default console control handler. This modified handler does not call 
<a href="https://msdn.microsoft.com/c26dbf15-62e8-4892-b7c5-2e6c085e4cd5">ExitProcess</a> when processing the <b>CTRL_LOGOFF_EVENT</b> and <b>CTRL_SHUTDOWN_EVENT</b> signals. This allows the service to continue running after the user logs off. If the service installs its own console control handler, this handler is called before the default handler. If the installed handler calls 
<b>ExitProcess</b> when processing the <b>CTRL_LOGOFF_EVENT</b> signal, the service exits when the user logs off.

Note that a third-party library or DLL can install a console control handler for your application. If it does, this handler overrides the default handler, and can cause the application to exit when the user logs off.




## -see-also




<a href="https://msdn.microsoft.com/6480e8ee-d228-4c07-99df-de1e0c3ca250">Console Control Handlers</a>



<a href="https://msdn.microsoft.com/2a0e5dcc-be48-42ab-a05a-96f68d012a67">Console Functions</a>



<a href="https://msdn.microsoft.com/c26dbf15-62e8-4892-b7c5-2e6c085e4cd5">ExitProcess</a>



<a href="https://msdn.microsoft.com/ed392d97-6fd0-4256-a783-bc7d27d01a10">GenerateConsoleCtrlEvent</a>



<a href="https://msdn.microsoft.com/68b48e67-c7e0-4434-bef5-b2aaebb343ff">GetProcessShutdownParameters</a>



<a href="https://msdn.microsoft.com/6fc64265-1403-45ea-925c-c5eb31d56734">SetConsoleCtrlHandler</a>



<a href="https://msdn.microsoft.com/c467950e-31e1-4608-a08a-0736a5524e0e">SetProcessShutdownParameters</a>
 

 

